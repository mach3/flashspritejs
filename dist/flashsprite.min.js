/**
 * FlashSprite.js
 * --------------
 * Load and play sprite animations made by Flash CS6+
 *
 * @version 0.9.1
 * @author mach3 <http://github.com/mach3>
 * @url http://github.com/mach3/flashspritejs
 * @require jquery.js
 */

(function(t){t.extend(t,{FlashSprite:function(i){var s=this;this.EVENT_READY="flashSpriteReady",this.EVENT_END="flashSpriteEnd",this.EVENT_ENTER_FRAME="flashSpriteEnterFrame",this.options={src:null,fps:30,autoPlay:!0,repeat:!0},this.vars={frames:null,meta:null,image:null,width:null,height:null,length:null,interval:null},this.node=i,this.index=0,this.timer=null,this.init=function(t){t&&this.config(t),this._load()},this.config=function(i){t.extend(this.options,i),this.vars.interval=Math.floor(1e3/this.options.fps)},this._call=function(i,s){t.isFunction(this[i])&&this[i].apply(this,s)},this._load=function(){t.getJSON(this.options.src).done(function(i){var e=new Image;t.extend(s.vars,{meta:i.meta,image:s.options.src.replace(/((\?|#).+|[^\/]+)?$/,"")+i.meta.image,frames:i.frames,length:i.frames.length,width:i.frames[0].frame.w,height:i.frames[0].frame.h}),e.onload=t.proxy(s._initNode,s),e.src=s.vars.image})},this._initNode=function(){this.node.width(this.vars.width).height(this.vars.height).css({"background-repeat":"no-repeat","background-image":"url("+this.vars.image+")"}),this.options.autoPlay&&this.play(),this.node.trigger(this.EVENT_READY)},this.play=function(){this.stop(),this._forward()},this.next=function(){var t=(this.index+1)%(this.vars.length-1);(this.options.repeat||t)&&this._goto(t)},this._forward=function(){var t=s.index;s.next(),t!==s.index?s.timer=setTimeout(s._forward,s.vars.interval):s.node.trigger(s.EVENT_END)},this.reverse=function(){this.stop(),this._backward()},this.prev=function(){var t=this.index-1;if(0>t){if(!this.options.repeat)return;t=this.vars.length-1}this._goto(t)},this._backward=function(){var t=s.index;s.prev(),t!==s.index?s.timer=setTimeout(s._backward,s.vars.interval):s.node.trigger(s.EVENT_END)},this._goto=function(t){0>t||t>=this.vars.length||(this.index=t,this.node.css("background-position","-"+this.vars.frames[this.index].frame.x+"px -"+this.vars.frames[this.index].frame.y+"px").trigger(this.EVENT_ENTER_FRAME))},this.stop=function(){clearTimeout(s.timer),s.timer=null},this.gotoAndStop=function(t){this.stop(),this._goto(t)},this.gotoAndPlay=function(t){this._goto(t),this.play()},this.rewind=function(){this._goto(0)}}}),t.fn.extend({flashSprite:function(){var i,s;return i=[],t.each(arguments,function(t,s){i.push(s)}),s="string"==typeof i[0]?i.shift():"init",this.each(function(){var e=t(this);e.data("flashSprite")||e.data("flashSprite",new t.FlashSprite(e)),e.data("flashSprite")._call(s,i)}),this}})})(jQuery);