/**
 * FlashSprite.js
 * --------------
 * Load and play sprite animations made by Flash CS6+
 *
 * @version 0.9.1
 * @author mach3 <http://github.com/mach3>
 * @url http://github.com/mach3/flashspritejs
 * @require jquery.js
 */

!function(a){a.extend(a,{FlashSprite:function(b){var c=this;this.EVENT_READY="flashSpriteReady",this.EVENT_END="flashSpriteEnd",this.EVENT_ENTER_FRAME="flashSpriteEnterFrame",this.options={dataHeader:"application/json; charset=utf-16",src:null,fps:30,autoPlay:!0,repeat:!0},this.vars={frames:null,meta:null,image:null,width:null,height:null,length:null,interval:null},this.node=b,this.index=0,this.timer=null,this.init=function(a){a&&this.config(a),this._load()},this.config=function(b){a.extend(this.options,b),this.vars.interval=Math.floor(1e3/this.options.fps)},this._call=function(b,c){a.isFunction(this[b])&&this[b].apply(this,c)},this._load=function(){var b=this.options;a.ajax({url:b.src,beforeSend:function(a){b.dataHeader&&a.overrideMimeType(b.dataHeader)}}).done(function(b){var d=new Image;a.extend(c.vars,{meta:b.meta,image:c.options.src.replace(/((\?|#).+|[^\/]+)?$/,"")+b.meta.image,frames:b.frames,length:b.frames.length,width:b.frames[0].sourceSize.w,height:b.frames[0].sourceSize.h}),d.onload=a.proxy(c._initNode,c),d.src=c.vars.image})},this._initNode=function(){this.node.width(this.vars.width).height(this.vars.height).css({"background-repeat":"no-repeat","background-image":"url("+this.vars.image+")"}),this.options.autoPlay&&this.play(),this.node.trigger(this.EVENT_READY)},this.play=function(){this.stop(),this._forward()},this.next=function(){var a=(this.index+1)%(this.vars.length-1);(this.options.repeat||a)&&this._goto(a)},this._forward=function(){var a=c.index;c.next(),a!==c.index?c.timer=setTimeout(c._forward,c.vars.interval):c.node.trigger(c.EVENT_END)},this.reverse=function(){this.stop(),this._backward()},this.prev=function(){var a=this.index-1;if(0>a){if(!this.options.repeat)return;a=this.vars.length-1}this._goto(a)},this._backward=function(){var a=c.index;c.prev(),a!==c.index?c.timer=setTimeout(c._backward,c.vars.interval):c.node.trigger(c.EVENT_END)},this._goto=function(a){0>a||a>=this.vars.length||(this.index=a,this.node.css("background-position","-"+this.vars.frames[this.index].frame.x+"px -"+this.vars.frames[this.index].frame.y+"px").trigger(this.EVENT_ENTER_FRAME))},this.stop=function(){clearTimeout(c.timer),c.timer=null},this.gotoAndStop=function(a){this.stop(),this._goto(a)},this.gotoAndPlay=function(a){this._goto(a),this.play()},this.rewind=function(){this._goto(0)}}}),a.fn.extend({flashSprite:function(){var b,c;return b=Array.prototype.slice.call(arguments),c="string"==typeof b[0]?b.shift():"init",this.each(function(){var d=a(this);d.data("flashSprite")||d.data("flashSprite",new a.FlashSprite(d)),d.data("flashSprite")._call(c,b)}),this}})}(jQuery);