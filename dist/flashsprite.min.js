/**
 * FlashSprite.js
 * --------------
 * Load and play sprite animations made by Flash CS6+
 *
 * @version 0.9.0
 * @author mach3 <http://github.com/mach3>
 * @url http://github.com/mach3/flashspritejs
 * @require jquery.js
 */

(function(t){t.extend(t,{FlashSprite:function(i){var s=this;this.options={src:null,fps:30,autoPlay:!0},this.vars={frames:null,meta:null,image:null,width:null,height:null,length:null,interval:null},this.node=i,this.index=0,this.timer=null,this.init=function(t){t&&this.config(t),this._load()},this.config=function(i){t.extend(this.options,i),this.vars.interval=Math.floor(1e3/this.options.fps)},this._call=function(i,s){t.isFunction(this[i])&&this[i].apply(this,s)},this._load=function(){t.getJSON(this.options.src).done(function(i){var n=new Image;t.extend(s.vars,{meta:i.meta,image:s.options.src.replace(/((\?|#).+|[^\/]+)?$/,"")+i.meta.image,frames:i.frames,length:i.frames.length,width:i.frames[0].frame.w,height:i.frames[0].frame.h}),n.onload=t.proxy(s._initNode,s),n.src=s.vars.image})},this._initNode=function(){this.node.width(this.vars.width).height(this.vars.height).css({"background-repeat":"no-repeat","background-image":"url("+this.vars.image+")"}),this.options.autoPlay&&this.play(),this.node.trigger("flashSpriteReady")},this.play=function(){this.stop(),this._forward()},this._forward=function(){s._goto((s.index+1)%(s.vars.length-1)),s.timer=setTimeout(s._forward,s.vars.interval)},this.reverse=function(){this.stop(),this._backward()},this._backward=function(){s.index-=1,0>s.index&&(s.index=s.vars.length-1),s._goto(s.index),s.timer=setTimeout(s._backward,s.vars.interval)},this._goto=function(t){0>t||t>=this.vars.length||(s.index=t,this.node.css("background-position","-"+this.vars.frames[this.index].frame.x+"px -"+this.vars.frames[this.index].frame.y+"px"))},s.stop=function(){clearTimeout(s.timer),s.timer=null},s.gotoAndStop=function(t){this.stop(),this._goto(t)},s.gotoAndPlay=function(t){this._goto(t),this.play()}}}),t.fn.extend({flashSprite:function(){var i,s;i=[],t.each(arguments,function(t,s){i.push(s)}),s="string"==typeof i[0]?i.shift():"init",this.each(function(){var n=t(this);n.data("flashSprite")||n.data("flashSprite",new t.FlashSprite(n)),n.data("flashSprite")._call(s,i)})}})})(jQuery);